<% content_for :meta_tags do %>
  <%= meta_tags title: "MLB Stats",
                description: "Major league stats for major league baseball!",
                service: "Chew's MLB Stats",
                keywords: "sports mlb baseball" %>
<% end %>

<h1>Chew's MLB Stats</h1>

<p>
  With this site, you can view information in unique ways. On a team page, you can see a team's 500 chart.
  Viewing a game shows a lot of information about the game, even some stuff Gameday doesn't show!
</p>

<h2>Table of Contents</h2>
<ul>
  <li><%= link_to "Today's Schedule", "#schedule" %></li>
  <li><%= header_link "Today's Homers" %></li>
  <li><%= link_to "Team Standings", "#standings" %></li>
</ul>

<h2 id="schedule">Today's Schedule</h2>
<p>Games today: <%= @schedule['totalGames'] %> (<%= @schedule['totalGamesInProgress'] %> in-progress)</p>
<p><%= link_to "Schedule Time-Machine", "/sports/mlb/schedule" %></p>

<div class="row">
  <% @schedule['dates'][0]['games'].each do |game| %>
    <div class="col-md-6">
      <%= render partial: 'game', locals: { game: game } %>
    </div>
  <% end %>
</div>

<hr>

<h2 id="today-s-homers">Today's Homers</h2>
<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover" data-toggle="table">
    <thead class="table-dark">
    <tr>
      <th data-sortable="true">Player</th>
      <th data-sortable="true">Team</th>
      <th data-sortable="true" data-sort-order="desc">Homer #</th>
      <th data-sortable="true" data-sort-order="desc">RBI</th>
      <th>Info</th>
    </tr>
    </thead>
    <tbody>
    <% @schedule['dates'][0]['games'].each do |game| %>
      <% next unless game['homeRuns'] %>
      <% game['homeRuns'].each do |homer| %>
    <% begin %>
        <tr <% if homer['result']['rbi'] == 4 %> class="table-warning" <% end %>>
          <td><%= homer['matchup']['batter']['fullName'] %></td>
          <td><%= game['teams'][homer['about']['halfInning'] == "top" ? "away" : "home"]['team']['teamName'] %></td>
          <% info = homer_info homer %>
          <td><%= info[0] %></td>
          <td><%= homer['result']['rbi'] %></td>
          <td><%= info[1] %></td>
        </tr>
    <% rescue StandardError => e %>
        <tr><td colspan="5">Could not load row! Error: <%= e %></td></tr>
        <% end %>
      <% end %>
    <% end %>
    </tbody>
  </table>
</div>

<hr>

<h2 id="standings">Team Standings</h2>

<p><%= link_to "View All Teams", "/sports/mlb/teams" %></p>

<div class="table-responsive">
<table class="table table-striped table-bordered table-hover" data-toggle="table" data-search="true">
  <thead class="table-dark">
  <tr>
    <th data-sortable="true" data-field="team" data-switchable="false" data-sort-order="asc">Team</th>
    <th data-sortable="true" data-field="wins" data-switchable="false" data-sort-order="desc">Wins</th>
    <th data-sortable="true" data-field="loss" data-switchable="false" data-sort-order="desc">Losses</th>
    <th data-sortable="true" data-field="ratio" data-switchable="false" data-sort-order="desc">Ratio</th>
  </tr>
  </thead>
  <tbody>
  <% @info.each do |division| %>
    <% division['teamRecords'].each do |team| %>
    <tr>
      <td><%= link_to team['team']['name'], "/sports/mlb/team/#{team['team']['id']}" %></td>
      <td><%= team['wins'] %></td>
      <td><%= team['losses'] %></td>
      <td><%= team['winningPercentage'] %></td>
    </tr>
    <% end %>
  <% end %>
  </tbody>
</table>
</div>