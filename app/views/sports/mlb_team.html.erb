<% content_for :meta_tags do %>
  <%= meta_tags title: "#{@team['name']} - MLB Team Stats",
                description:
                  "View stats for the MLB team #{@team['name']}. They have won #{@team['wins']} and lost #{@team['losses']} games this season, and are #{@team['to500'].abs} #{@team['to500'] > 0 ? 'above' : 'below'} 500.",
                service: "Chew's MLB Stats",
                keywords: "sports mlb baseball #{@team['name']}" %>
<% end %>

<h1>Info for Team <%= @team['name'] %></h1>

<h2>Above/Below 500</h2>

<span id="win_sum" class="visually-hidden"><%= @win_sum.join(' ') %></span>
<span id="above_500" class="visually-hidden"><%= @above500.join(' ') %></span>

<canvas id="myChart" width="800" height="400"></canvas>

<h2>Schedule</h2>

<div class="table-responsive">
<table class="table">
  <thead>
  <tr>
    <th>Date</th>
    <th>Away Team</th>
    <th>Home Team</th>
    <th>Score</th>
    <th>State</th>
    <th>Result</th>
  </tr>
  </thead>
  <tbody>
  <% @scores['dates'].each do |date| %>
    <% date['games'].each do |game| %>
      <% state = mlb_game_state params[:team_id].to_i, game %>
      <tr class="<% if state == "Win" %> table-success <% elsif state == "Loss" %> table-danger <% else %> table-secondary <% end %> ">
        <% if %w[Postponed Scheduled Pre-Game].include? game['status']['detailedState'] %>
          <td><%= date['date'] %></td>
        <% else %>
          <td><%= link_to date['date'], "/sports/mlb/game/#{game['gamePk']}" %></td>
        <% end %>
        <td class="<% "bold" if game['teams']['away']['team']['id'] == params['id'] %>>"><%= link_to game['teams']['away']['team']['name'], "/sports/mlb/team/#{game['teams']['away']['team']['id']}" %></td>
        <td><%= link_to game['teams']['home']['team']['name'], "/sports/mlb/team/#{game['teams']['home']['team']['id']}" %></td>
        <td><%= game['teams']['away']['score'] %> - <%= game['teams']['home']['score'] %></td>
        <td><%= state %></td>
        <td><%= game['status']['detailedState'] %><% if game['status']['reason'] %>: <%= game['status']['reason'] %><% end %></td>
      </tr>
    <% end %>
  <% end %>
  </tbody>
</table>
</div>

<% content_for :extra_foot do %>
  <%= javascript_pack_tag "sports/team_win_chart" %>
<% end %>